-----------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/kahrens/MyProjects/pystacked/cert/log_cs_pystacked_class.txt
  log type:  text
 opened on:   3 Oct 2021, 15:37:49

. 
. clear all

.  
. if "`c(username)'"=="kahrens" {
.         adopath + "/Users/kahrens/MyProjects/pystacked"
  [1]  (BASE)      "/Applications/Stata 16/ado/base/"
  [2]  (SITE)      "/Applications/Stata 16/ado/site/"
  [3]              "."
  [4]  (PERSONAL)  "/Users/kahrens/Documents/Stata/ado/personal/"
  [5]  (PLUS)      "/Users/kahrens/Library/Application Support/Stata/ado/plus/"
  [6]  (OLDPLACE)  "~/ado/"
  [7]              "/Users/kahrens/MyProjects/pystacked"
. }

. else {
.         net install pystacked, ///
>                 from(https://raw.githubusercontent.com/aahrens1/pystacked/main) replace
. }

. which pystacked 
/Users/kahrens/MyProjects/pystacked/pystacked.ado
*! pystacked v0.1 (first release)
*! last edited: 3oct2021
*! authors: aa/ms

. python: import sklearn

. python: sklearn.__version__
'1.0'

. 
. 
. *******************************************************************************
. *** try voting                                                                                     
>                                      ***
. *******************************************************************************
. 
. insheet using https://archive.ics.uci.edu/ml/machine-learning-databases/spambase/spambase.data, cle
> ar comma
(58 vars, 4,601 obs)

.                                                 
. pystacked v58 v1-v57, type(class) pyseed(123) ///
>                                                         methods(lassocv rf nnet) /// 
>                                                         njobs(4) pipe1(poly2) ///
>                                                         voting voteweights(0.1 .4) ///
>                                                         votetype(soft)
---------------------------------------
  Method         |      Weight
-----------------+---------------------
  lassocv        |      0.1000000
  rf             |      0.4000000
  nnet           |      0.5000000

.                         
. 
. *******************************************************************************
. *** try other estimators                                                                           
>                              ***
. *******************************************************************************
. 
. insheet using https://archive.ics.uci.edu/ml/machine-learning-databases/spambase/spambase.data, cle
> ar comma
(58 vars, 4,601 obs)

. 
. local m1 logit lassocv gradboost nnet

. local m2 logit lassocv rf nnet

. local m3 logit ridgecv gradboost nnet

. local m4 logit elasticcv gradboost nnet

. local m5 logit elasticcv gradboost svm

. local m6 logit elasticcv gradboost linsvm

. 
. foreach m in "`m1'" "`m2'" "`m3'" "`m4'" "`m5'" "`m6'" {
  2.         di "`m'"
  3.         pystacked v58 v1-v57, type(class) pyseed(123) ///
>                                                         methods(`m') /// 
>                                                         njobs(4)
  4. }
logit lassocv gradboost nnet
---------------------------------------
  Method         |      Weight
-----------------+---------------------
  logit          |      0.0376713
  lassocv        |      0.0000000
  gradboost      |      0.8304882
  nnet           |      0.1318405
logit lassocv rf nnet
---------------------------------------
  Method         |      Weight
-----------------+---------------------
  logit          |      0.1266155
  lassocv        |      0.0000000
  rf             |      0.7258337
  nnet           |      0.1475508
logit ridgecv gradboost nnet
---------------------------------------
  Method         |      Weight
-----------------+---------------------
  logit          |      0.0000000
  ridgecv        |      0.0612995
  gradboost      |      0.7370860
  nnet           |      0.2016145
logit elasticcv gradboost nnet
---------------------------------------
  Method         |      Weight
-----------------+---------------------
  logit          |      0.0000000
  elasticcv      |      0.0000000
  gradboost      |      0.7984115
  nnet           |      0.2015885
logit elasticcv gradboost svm
---------------------------------------
  Method         |      Weight
-----------------+---------------------
  logit          |      0.1024413
  elasticcv      |      0.0000000
  gradboost      |      0.8887822
  svm            |      0.0087765
logit elasticcv gradboost linsvm
---------------------------------------
  Method         |      Weight
-----------------+---------------------
  logit          |      0.0978207
  elasticcv      |      0.0000000
  gradboost      |      0.9015952
  linsvm         |      0.0005841

. 
. *******************************************************************************
. *** check that predicted value = weighted avg of transform variables            ***
. *******************************************************************************
.                                                  
. insheet using https://archive.ics.uci.edu/ml/machine-learning-databases/spambase/spambase.data, cle
> ar comma
(58 vars, 4,601 obs)

. 
. pystacked v58 v1-v57, type(class) pyseed(123)
---------------------------------------
  Method         |      Weight
-----------------+---------------------
  logit          |      0.0966593
  lassocv        |      0.0000000
  gradboost      |      0.9033407

. 
. predict double yhat, pr

. list yhat if _n < 10

      +-----------+
      |      yhat |
      |-----------|
   1. | .94596963 |
   2. | .97638563 |
   3. | .99292243 |
   4. | .95213176 |
   5. | .95211578 |
      |-----------|
   6. | .66053313 |
   7. | .88218763 |
   8. | .66044895 |
   9. | .98867417 |
      +-----------+

. 
. predict double t, transform  

. 
. mat W = e(weights)

. gen myhat = t0*el(W,1,1)+t1*el(W,2,1)+t2*el(W,3,1)

. 
. assert reldif(yhat,myhat)<0.0001

. 
. log close
      name:  <unnamed>
       log:  /Users/kahrens/MyProjects/pystacked/cert/log_cs_pystacked_class.txt
  log type:  text
 closed on:   3 Oct 2021, 16:02:52
-----------------------------------------------------------------------------------------------------
